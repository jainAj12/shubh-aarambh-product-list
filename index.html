<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shubh Aarambh Products Cost(Local Storage)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            padding: 20px;
        }
        .manager-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            overflow: hidden;
            padding: 2rem;
        }
        .input-item {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: border-color 0.2s;
        }
        .input-item:focus {
            outline: none;
            border-color: #10b981; /* Emerald 500 */
        }
    </style>
</head>
<body>

    <div id="manager-container" class="manager-container">

        <!-- Header -->
        <header class="mb-8 p-4 border-b-4 border-emerald-500 rounded-t-lg bg-emerald-50">
            <h1 class="text-3xl font-extrabold text-emerald-800 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 11a1 1 0 100 2h1a1 1 0 100-2H4zm14 0a1 1 0 100 2h-1a1 1 0 100-2h1zM5.636 5.636a1 1 0 000 1.414l.707.707a1 1 0 101.414-1.414l-.707-.707a1 1 0 00-1.414 0zm12.728 12.728a1 1 0 000-1.414l-.707-.707a1 1 0 00-1.414 1.414l.707.707a1 1 0 001.414 0zM12 10a2 2 0 11-4 0 2 2 0 014 0z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-7-8a1 1 0 001-1v-2a1 1 0 10-2 0v2a1 1 0 001 1zM16 9a1 1 0 100 2h2a1 1 0 100-2h-2zm-5 7a1 1 0 100-2h2a1 1 0 100 2h-2z" clip-rule="evenodd" />
                </svg>
                Shubh Aarambh Products List
            </h1>
            <p class="text-sm text-emerald-600 mt-2 font-medium">All data is saved securely in your browser's local storage.</p>
        </header>

        <!-- Item Table -->
        <section class="mb-6">
            <h2 class="text-xl font-bold text-gray-700 mb-4">Product List</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg border border-gray-200">
                    <thead class="bg-gray-100 border-b border-gray-300">
                        <tr class="text-sm font-semibold text-gray-600 uppercase tracking-wider">
                            <th class="p-3 text-left w-5/12">Description</th>
                            <th class="p-3 text-right w-1/12">Qty</th>
                            <th class="p-3 text-right w-2/12">Unit Price (₹)</th>
                            <th class="p-3 text-right w-2/12">Total Cost (₹)</th>
                            <th class="p-3 text-center w-1/12"></th>
                        </tr>
                    </thead>
                    <tbody id="item-list">
                        <!-- Data rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Buttons Section -->
            <div class="flex items-center space-x-4">
                <!-- Add Item Button -->
                <button onclick="addNewProduct()" class="mt-6 px-6 py-3 bg-emerald-600 text-white font-bold rounded-full shadow-lg hover:bg-emerald-700 transition duration-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add New Product
                </button>

                <!-- NEW Save Button -->
                <button id="save-button" onclick="saveProductsWithFeedback()" class="mt-6 px-6 py-3 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-4 3v4m-2 0h4m-7-3h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v1"></path>
                    </svg>
                    Save Changes
                </button>

                <!-- Feedback Span -->
                <span id="save-feedback" class="mt-6 text-base text-blue-600 font-semibold opacity-0 transition duration-500"></span>
            </div>
        </section>

    </div>

    <script>
        // Global array to store product data
        let products = [];
        const STORAGE_KEY = 'productCostManagerData';

        // Currency formatter for Indian Rupee (INR)
        const currencyFormatter = new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
        });

        // --- LOCAL STORAGE HANDLING ---

        // Function to save the products array to local storage
        function saveProducts() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
            } catch (e) {
                console.error("Error saving to local storage:", e);
                // Note: Per instructions, custom modal needed instead of alert
                console.error("Warning: Could not save data to local storage. Your data may be lost if you refresh.");
            }
        }

        // Function to load data from local storage on startup
        function loadProducts() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                products = JSON.parse(savedData);
            } else {
                // Default initial data if nothing is saved yet
                products = [
                    { id: 1, description: 'Default Packing Material', quantity: 1, unitPrice: 500.00 },
                    { id: 2, description: 'Labour Charges (Hours)', quantity: 4, unitPrice: 250.00 }
                ];
            }
        }

        // --- UI Feedback Function ---
        window.saveProductsWithFeedback = function() {
            saveProducts(); // Explicitly call the save function
            
            const feedbackSpan = document.getElementById('save-feedback');
            feedbackSpan.textContent = 'Saved!';
            feedbackSpan.classList.remove('opacity-0', 'text-gray-500');
            feedbackSpan.classList.add('opacity-100', 'text-blue-600', 'font-semibold');
            
            // Clear the feedback after 2 seconds
            setTimeout(() => {
                feedbackSpan.classList.remove('opacity-100', 'text-blue-600', 'font-semibold');
                feedbackSpan.classList.add('opacity-0', 'text-gray-500');
            }, 2000);
        }

        // --- IN-MEMORY CRUD OPERATIONS ---

        // Adds a new product to the local array
        window.addNewProduct = function() {
            // Use a highly unique ID based on time
            const newId = Date.now() + Math.floor(Math.random() * 1000); 
            products.push({
                id: newId,
                description: 'New Product/Service',
                quantity: 1,
                unitPrice: 0.00,
            });
            saveProducts(); // Save data after adding
            renderProductList();
        }
        
        // Updates an existing product in the local array
        window.updateProduct = function(docId, field, value) {
            const product = products.find(p => p.id === docId);
            if (product) {
                if (field === 'description') {
                    product.description = value.trim();
                } else {
                    product[field] = parseFloat(value) || 0;
                }
                saveProducts(); // Save data after updating
                renderProductList(); // Re-render line totals (Total Cost)
            }
        }

        // Deletes a product from the local array
        window.deleteProduct = function(docId) {
            products = products.filter(p => p.id !== docId);
            saveProducts(); // Save data after deleting
            renderProductList();
        }

        // --- UI RENDERING AND CALCULATION ---

        function renderProductList() {
            const itemList = document.getElementById('item-list');
            let subtotal = 0; 
            itemList.innerHTML = ''; // Clear existing rows

            if (products.length === 0) {
                itemList.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500 italic">No products added yet. Click 'Add New Product' to begin.</td></tr>`;
            } else {
                products.forEach(product => {
                    const qty = product.quantity || 0;
                    const price = product.unitPrice || 0;
                    const lineTotal = qty * price;
                    subtotal += lineTotal;

                    const formattedLineTotal = currencyFormatter.format(lineTotal);
                    const formattedPrice = parseFloat(price).toFixed(2);
                    
                    const newRow = document.createElement('tr');
                    newRow.className = 'item-row border-b border-gray-100 hover:bg-emerald-50';
                    
                    // Use a string representation of the ID for onblur events
                    newRow.innerHTML = `
                        <td class="p-3">
                            <input type="text" value="${product.description}" 
                                class="input-item w-full" 
                                onblur="updateProduct(${product.id}, 'description', this.value)" 
                                placeholder="Product Description">
                        </td>
                        <td class="p-3">
                            <input type="number" min="0" value="${qty}" 
                                class="input-item w-full text-right" 
                                onblur="updateProduct(${product.id}, 'quantity', this.value)">
                        </td>
                        <td class="p-3">
                            <input type="number" min="0" value="${formattedPrice}" step="0.01" 
                                class="input-item w-full text-right" 
                                onblur="updateProduct(${product.id}, 'unitPrice', this.value)">
                        </td>
                        <td class="p-3 text-right font-semibold text-gray-800">${formattedLineTotal}</td>
                        <td class="p-3 text-center">
                            <button onclick="deleteProduct(${product.id})" 
                                class="text-red-500 hover:text-red-700 transition duration-150 p-2 rounded-full hover:bg-red-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3"></path>
                                </svg>
                            </button>
                        </td>
                    `;
                    itemList.appendChild(newRow);
                });
            }
        }

        // Initialize the app on load: Load data then render
        window.onload = function() {
            loadProducts();
            renderProductList();
        };
    </script>
</body>
</html>
